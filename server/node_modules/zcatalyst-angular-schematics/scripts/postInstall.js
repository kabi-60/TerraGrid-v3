#!/usr/bin/env node
/* eslint-disable @typescript-eslint/no-var-requires */

try {
	const { statSync, writeFileSync } = require('fs');
	const { join } = require('path');
	const collectionTemplate = require('../collectionTemplate.js');

	const collectionFileName = join(__dirname, '../collection.json');
	const placeHolder = '{{location}}';

	let isNodeModules = false;
	try {
		isNodeModules = statSync(join(__dirname, '../node_modules')).isDirectory();
	} catch (err) {
		if (err.code !== 'ENOENT') {
			// eslint-disable-next-line no-console
			console.error(err);
		}
	}

	if (isNodeModules) {
		const collectionFile = JSON.stringify(collectionTemplate).replace(new RegExp(placeHolder, 'g'), './node_modules');
		writeFileSync(collectionFileName, collectionFile);
	} else {
		const collectionFile = JSON.stringify(collectionTemplate).replace(new RegExp(placeHolder, 'g'), '..');
		writeFileSync(collectionFileName, collectionFile);
	}
} catch (err) {
	// eslint-disable-next-line no-console
	console.log('Error! zcatalyst-angular-schematics not installed properly');
	// eslint-disable-next-line no-console
	console.error(err);
}
