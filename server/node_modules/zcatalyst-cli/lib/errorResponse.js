'use strict';
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const error_1 = __importDefault(require("./error"));
const js_1 = require("./util_modules/js");
exports.default = (response, body, skipHelp = false) => {
    body =
        js_1.JS.includes(response.headers['content-type'], 'json') && typeof body === 'string'
            ? JSON.parse(body)
            : body;
    const message = 'HTTP Error: ' +
        response.statusCode +
        ', ' +
        js_1.JS.get(body, 'data.message', response.statusCode === 404 ? 'Not Found' : 'Unknown Error');
    let exitCode;
    if (response.statusCode >= 500) {
        exitCode = 2;
    }
    else {
        exitCode = 1;
    }
    js_1.JS.unset(response, 'request.headers');
    return new error_1.default(message, {
        context: {
            body,
            response
        },
        status: response.statusCode,
        skipHelp,
        exit: exitCode
    });
};
